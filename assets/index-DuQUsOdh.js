import{initializeApp as G}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";import{getAuth as D,setPersistence as H,browserLocalPersistence as K,onAuthStateChanged as j,signInWithEmailAndPassword as V}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";import{getFirestore as w,setLogLevel as W,collection as O,serverTimestamp as $,addDoc as J,query as Q,onSnapshot as X,doc as q,deleteDoc as Y,setDoc as ee}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";import{getAnalytics as te}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();let f,F,ne,ie,h;async function se(n,e){try{if(console.log("Starting Firebase initialization..."),!n||typeof n!="object")throw new Error("Invalid Firebase configuration");const s=["apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId"].filter(i=>!n[i]);if(s.length>0)throw new Error(`Missing required Firebase configuration fields: ${s.join(", ")}`);f=G(n),console.log("Firebase app initialized"),F=D(f),console.log("Firebase auth initialized"),await H(F,K),console.log("Firebase auth persistence enabled"),ne=w(f),console.log("Firestore initialized");try{ie=te(f),console.log("Analytics initialized")}catch(i){console.warn("Analytics initialization failed:",i)}W("debug"),j(F,oe),console.log("Firebase initialization completed successfully"),window.dispatchEvent(new CustomEvent("firebaseInitialized"))}catch(t){throw console.error("Error initializing Firebase:",t),new Error(`Firebase initialization failed: ${t.message}`)}}async function oe(n){try{if(n){h=n.uid,console.log("User is signed in with UID:",h),localStorage.setItem("lastUserId",h);const e=document.getElementById("user-id-display");e&&(e.textContent=`User ID: ${h}`),window.dispatchEvent(new CustomEvent("userAuthenticated",{detail:{userId:h}}))}else console.log("User is signed out"),h=null}catch(e){throw console.error("Error in auth state change:",e),new Error(`Authentication state change failed: ${e.message}`)}}function B(){return h}const re={apiKey:"AIzaSyAX1F4gzD0-nsAbj7yhSaJZxcwvWNRVFus",authDomain:"kelly-s-kuisine.firebaseapp.com",projectId:"kelly-s-kuisine",storageBucket:"kelly-s-kuisine.firebasestorage.app",messagingSenderId:"974729459966",appId:"1:974729459966:web:42bad27bd106242bfc0daf",measurementId:"G-CGY3C6F1Q2"},ce="1:974729459966:web:42bad27bd106242bfc0daf",P={RECIPES:"recipes"},U={SEARCH_DEBOUNCE_MS:300,MESSAGE_TIMEOUT_MS:5e3};let g=[],R=null;async function ae(){if(!B())throw new Error("User must be authenticated to initialize recipes");le(),de()}function le(){const n=w(f),e=B();if(console.log("[Recipes] Setting up listener for user:",e),!e){console.error("[Recipes] No user ID available, cannot set up recipes listener"),u("User authentication required to load recipes");return}const t=O(n,"users",e,P.RECIPES),s=Q(t);console.log("[Recipes] Firestore collection path:",`users/${e}/${P.RECIPES}`),console.log("[Recipes] Full collection reference:",t),R&&(console.log("[Recipes] Unsubscribing from previous listener"),R()),console.log("[Recipes] Starting Firestore listener..."),R=X(s,i=>{console.log("[Recipes] ‚úÖ Snapshot received successfully!"),console.log(`[Recipes] Empty: ${i.empty}, Size: ${i.size}`),console.log("[Recipes] Snapshot metadata:",i.metadata),g=[],i.forEach(o=>{const l={id:o.id,...o.data()};console.log("[Recipes] Processing recipe document:",{id:o.id,data:o.data(),fullRecipe:l}),g.push(l)}),console.log("[Recipes] Final processed recipes array:",g),console.log("[Recipes] Number of recipes loaded:",g.length),g.sort((o,l)=>(o.itemName||"").localeCompare(l.itemName||"")),console.log("[Recipes] Calling displayRecipes..."),_(),console.log("[Recipes] displayRecipes completed")},i=>{console.error("[Recipes] ‚ùå Error in Firestore listener:",i),console.error("[Recipes] Error details:",{code:i.code,message:i.message,stack:i.stack}),i.code==="permission-denied"?u("Permission denied: Please check your Firestore security rules"):i.code==="unavailable"?u("Database unavailable: Please check your internet connection"):u(`Failed to load recipes: ${i.message}`)}),console.log("[Recipes] Listener setup completed, unsubscribe function:",R)}function de(){window.addEventListener("searchFilterChanged",n=>{const{searchTerm:e,filterCategory:t}=n.detail;ue(e,t)})}function ue(n,e){const t=n?n.toLowerCase():"",s=g.filter(i=>{const o=!t||i.itemName&&i.itemName.toLowerCase().includes(t)||i.description&&i.description.toLowerCase().includes(t)||i.ingredients&&i.ingredients.some(p=>p.toLowerCase().includes(t))||i.instructions&&i.instructions.some(p=>p.toLowerCase().includes(t)),l=e==="All"||i.categories&&i.categories.includes(e);return o&&l});_(s)}function _(n=g){console.log("[Recipes] üéØ displayRecipes called"),console.log("[Recipes] Recipes to display:",n),console.log("[Recipes] Number of recipes to display:",n.length);const e=document.getElementById("recipe-container");if(!e){console.error("[Recipes] ‚ùå Recipe container element not found!"),console.error('[Recipes] Available elements with "recipe" in ID:',Array.from(document.querySelectorAll('[id*="recipe"]')).map(t=>t.id));return}if(console.log("[Recipes] ‚úÖ Recipe container found:",e),console.log("[Recipes] Container styles:",{display:window.getComputedStyle(e).display,height:window.getComputedStyle(e).height,width:window.getComputedStyle(e).width,visibility:window.getComputedStyle(e).visibility,position:window.getComputedStyle(e).position}),console.log("[Recipes] Container current content length:",e.innerHTML.length),n.length===0){const t='<p class="text-center text-gray-500 col-span-full">No recipes found. Try adjusting your search or add a new recipe.</p>';e.innerHTML=t,console.log('[Recipes] üìù Displayed "no recipes" message')}else e.innerHTML="",console.log("[Recipes] üßπ Cleared container, adding recipe cards..."),n.forEach((t,s)=>{console.log(`[Recipes] Creating card ${s+1}/${n.length} for recipe:`,t.itemName);try{const i=me(t);e.appendChild(i),console.log(`[Recipes] ‚úÖ Card ${s+1} added successfully`)}catch(i){console.error(`[Recipes] ‚ùå Error creating card ${s+1}:`,i)}}),console.log("[Recipes] üéâ All recipe cards added to container");console.log("[Recipes] Final container content length:",e.innerHTML.length)}function me(n){const e=document.createElement("div");e.className="bg-white rounded-xl shadow-lg overflow-hidden recipe-card flex flex-col justify-between min-h-[300px] w-full";const t=document.createElement("div");t.className="p-6";const s=n.itemName||"Unnamed Recipe",i=n.categories||[],o=n.description||"",l=n.ingredients||[],p=n.instructions||[],I=n.notes||"",v=document.createElement("h3");if(v.className="text-2xl font-playfair text-amber-700 mb-3",v.textContent=s,t.appendChild(v),i.length>0){const a=document.createElement("p");a.className="text-xs text-amber-500 mb-2",a.textContent=`Categories: ${i.join(", ")}`,t.appendChild(a)}if(o){const a=document.createElement("p");a.className="text-gray-600 text-sm mb-4",a.textContent=o,t.appendChild(a)}const C=(a,m,r)=>{if(m.length===0)return;const E=document.createElement("div");E.className="mt-4";const b=document.createElement("h4");b.className="font-semibold text-amber-600",b.textContent=a,E.appendChild(b);const N=document.createElement(r?"ol":"ul");N.className=`${r?"list-decimal":"list-disc"} list-inside text-gray-700 text-sm mt-2`,m.forEach(Z=>{const T=document.createElement("li");T.textContent=Z,N.appendChild(T)}),E.appendChild(N),t.appendChild(E)};if(C("Ingredients:",l,!1),C("Instructions:",p,!0),I){const a=document.createElement("div");a.className="mt-4";const m=document.createElement("h4");m.className="font-semibold text-amber-600",m.textContent="Notes:",a.appendChild(m);const r=document.createElement("p");r.className="text-gray-600 italic text-sm mt-2",r.textContent=I,a.appendChild(r),t.appendChild(a)}e.appendChild(t);const y=document.createElement("div");y.className="p-6 pt-0 flex justify-end space-x-2";const d=document.createElement("button");d.className="edit-recipe px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm",d.textContent="Edit",d.dataset.recipeId=n.id,d.addEventListener("click",()=>he(n.id));const c=document.createElement("button");return c.className="delete-recipe px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 text-sm",c.textContent="Delete",c.dataset.recipeId=n.id,c.addEventListener("click",()=>fe(n.id)),y.appendChild(d),y.appendChild(c),e.appendChild(y),e}async function pe(n){try{console.log("Starting to add recipe:",n);const e=w(f),t=B();if(console.log("Current user ID:",t),!t)throw new Error("User not authenticated for adding recipe.");const s=O(e,"users",t,"recipes");console.log("Firestore collection path:",`users/${t}/recipes`);const i={...n,createdAt:$(),updatedAt:$()};console.log("Attempting to save recipe to Firestore...");const o=await J(s,i);console.log("Recipe saved successfully with ID:",o.id),S("Recipe added successfully!")}catch(e){throw console.error("Error adding recipe to Firestore:",e),console.error("Error details:",{code:e.code,message:e.message,stack:e.stack}),u(`Failed to add recipe: ${e.message}`),e}}async function ge(n,e){try{const t=w(f),s=B();if(!s)throw new Error("User not authenticated for updating recipe.");const i=q(t,"users",s,"recipes",n),o={...e,updatedAt:$()};await ee(i,o,{merge:!0}),S("Recipe updated successfully!")}catch(t){throw console.error("Error updating recipe in Firestore:",t),u("Failed to update recipe."),t}}async function fe(n){try{if(!confirm("Are you sure you want to delete this recipe?"))return;const e=w(f),t=B();if(!t)throw new Error("User not authenticated for deleting recipe.");const s=q(e,"users",t,"recipes",n);await Y(s),S("Recipe deleted successfully!")}catch(e){throw console.error("Error deleting recipe from Firestore:",e),u("Failed to delete recipe."),e}}function he(n){const e=g.find(t=>t.id===n);e?Le(e):u("Recipe not found for editing.")}let A="",z="All",L=null;function ye(){Ee(),Ie(),ve()}function Ee(){console.log("Attaching UI event listeners...");const n=document.getElementById("manualEntryBox"),e=document.getElementById("ocrEntryBox"),t=document.getElementById("addManualRecipeButton"),s=document.getElementById("cancelEditButton");n&&n.addEventListener("click",()=>{console.log("Manual entry box clicked!"),document.getElementById("manualInputSection").classList.remove("hidden"),document.getElementById("ocrInputSection").classList.add("hidden")}),e&&e.addEventListener("click",()=>{console.log("OCR entry box clicked!"),document.getElementById("ocrInputSection").classList.remove("hidden"),document.getElementById("manualInputSection").classList.add("hidden")}),t&&t.addEventListener("click",we);const i=document.getElementById("addFileRecipeButton");i&&i.addEventListener("click",Be);const o=document.getElementById("saveChangesButton");o&&o.addEventListener("click",Se),s&&s.addEventListener("click",()=>{document.getElementById("edit-recipe-modal").classList.add("hidden")})}function Ie(){const n=document.getElementById("searchInput"),e=document.getElementById("categoryFilter");if(n){let t;n.addEventListener("input",s=>{clearTimeout(t),t=setTimeout(()=>{A=s.target.value.toLowerCase(),window.dispatchEvent(new CustomEvent("searchFilterChanged",{detail:{searchTerm:A,filterCategory:z}}))},U.SEARCH_DEBOUNCE_MS)})}e&&e.addEventListener("change",t=>{z=t.target.value,window.dispatchEvent(new CustomEvent("searchFilterChanged",{detail:{searchTerm:A,filterCategory:z}}))})}function ve(){const n=document.getElementById("recipeForm");if(!n)return;n.querySelectorAll("input, textarea").forEach(t=>{t.addEventListener("input",()=>be(t))})}function be(n){const e=n.value;let t=!0,s="";n.required&&!e.trim()&&(t=!1,s="This field is required");const i=n.getAttribute("maxlength");i&&e.length>i&&(t=!1,s=`Maximum length is ${i} characters`),n.classList.toggle("border-red-500",!t);const o=n.parentElement.querySelector(".error-message");return o&&(o.textContent=s,o.classList.toggle("hidden",t)),t}async function we(n){n.preventDefault();const e={itemName:document.getElementById("itemName").value,categories:document.getElementById("categories").value,description:document.getElementById("description").value,ingredients:document.getElementById("ingredients").value,instructions:document.getElementById("instructions").value,notes:document.getElementById("notes").value||""};if(e.categories=e.categories.split(",").map(t=>t.trim()).filter(Boolean),e.ingredients=e.ingredients.split(`
`).map(t=>t.trim()).filter(Boolean),e.instructions=e.instructions.split(`
`).map(t=>t.trim()).filter(Boolean),!e.itemName||e.ingredients.length===0||e.instructions.length===0){u("Recipe Name, Ingredients, and Instructions are required.");return}try{k("Saving recipe..."),await pe(e),document.getElementById("itemName").value="",document.getElementById("categories").value="",document.getElementById("description").value="",document.getElementById("ingredients").value="",document.getElementById("instructions").value="",document.getElementById("notes").value="",document.getElementById("manualInputSection").classList.add("hidden")}catch(t){console.error("Error saving recipe:",t)}finally{M()}}async function Be(){const n=document.getElementById("fileInput"),e=n.files[0];if(!e){u("Please select a file to upload.");return}k("Processing file, this may take a moment...");try{let t="";if(e.type==="text/plain")t=await e.text();else if(e.type.startsWith("image/")){const{data:i}=await Tesseract.recognize(e,"eng",{logger:o=>console.log(`[OCR] ${o.status}: ${Math.round(o.progress*100)}%`)});t=i.text}else throw new Error("Unsupported file type. Please use .txt, .jpg, or .png.");const s=Ce(t);Re(s),document.getElementById("manualInputSection").classList.remove("hidden"),document.getElementById("ocrInputSection").classList.add("hidden"),S("Recipe data extracted! Please review and save.")}catch(t){console.error("Error processing file:",t),u(t.message||"Failed to process file.")}finally{M(),n.value=""}}function Ce(n){const e=n.split(`
`).map(d=>d.trim()).filter(Boolean);if(e.length===0)return{};const t={itemName:"",description:"",categories:[],ingredients:[],instructions:[],notes:""};let s="header",i=!1,o=!1;const l={ingredients:["ingredients"],instructions:["instructions","directions","method","preparation","steps"],nutrition:["nutrition facts","nutrition information","per serving","calories"],timing:["prep time","total time","cook time","servings","serves","yield"]},p=/^([A-Za-z\s]+):\s*$/,I=[/allrecipes/i,/alecipes/i,/food\.com/i,/epicurious/i,/tasty/i,/yummly/i,/test kitchen/i,/submitted by/i,/tested by/i,/recipe hub/i,/recipe of the day/i,/recipe(s)?!/i,/\bservings?\b/i,/\bminutes?\b/i,/\bcook time\b/i,/\bprep time\b/i,/\btotal time\b/i];function v(d){return d.replace(/¬Ω/g,"1/2").replace(/‚Öì/g,"1/3").replace(/‚Öî/g,"2/3").replace(/¬º/g,"1/4").replace(/¬æ/g,"3/4").replace(/‚Öï/g,"1/5").replace(/‚Öñ/g,"2/5").replace(/‚Öó/g,"3/5").replace(/‚Öò/g,"4/5").replace(/‚Öô/g,"1/6").replace(/‚Öö/g,"5/6").replace(/‚Öõ/g,"1/8").replace(/‚Öú/g,"3/8").replace(/‚Öù/g,"5/8").replace(/‚Öû/g,"7/8").replace(/(^|\s)%(?=\s|$)/g,"$11/2").replace(/%/g,"1/2").replace(/(\d)([a-zA-Z])/g,"$1 $2").replace(/\b[Ii]nafood\b/g,"In a food").replace(/\b[Ii]nthe\b/g,"in the").replace(/\b[Ii]ntoa\b/g,"into a").replace(/\b[Ii]ntothe\b/g,"into the").replace(/\b[Ii]n([aA])([A-Za-z]+)/g,"In a $2").replace(/\b([Oo]f|[Tt]o|[Oo]n|[Aa]t|[Bb]y|[Aa]n|[Aa])([A-Z][a-z]+)/g,"$1 $2").replace(/\b([a-zA-Z]{1,2})([A-Z][a-z]+)/g,"$1 $2").replace(/([a-z])([A-Z])/g,"$1 $2").replace(/([a-z])([ai])([a-z]+)/g,"$1 $2$3").replace(/t\s*a\s*s\s*p\s*o\s*o\s*n/gi,"teaspoon").replace(/t\s*b\s*s\s*p\s*o\s*o\s*n/gi,"tablespoon").replace(/b\s*a\s*k\s*i\s*n\s*g/gi,"baking").replace(/m\s*i\s*l\s*k/gi,"milk").replace(/a\s*a\s*l\s*l-?p\s*u\s*r\s*p\s*o\s*s\s*e/gi,"all-purpose").replace(/s\s*u\s*g\s*a\s*r/gi,"sugar").replace(/b\s*u\s*t\s*t\s*e\s*r/gi,"butter").replace(/e\s*g\s*g/gi,"egg").replace(/l\s*a\s*r\s*g\s*e/gi,"large").replace(/f\s*l\s*o\s*u\s*r/gi,"flour").replace(/p\s*o\s*w\s*d\s*e\s*r/gi,"powder").replace(/s\s*a\s*l\s*t/gi,"salt").replace(/m\s*e\s*l\s*t/gi,"melt").replace(/w\s*h\s*i\s*t\s*e/gi,"white").replace(/a\s*r\s*g\s*e\s*e\s*g\s*g/gi,"large egg").replace(/a\s*r\s*g\s*e\s*g\s*g/gi,"large egg").replace(/l\s*a\s*r\s*g\s*e\s*e\s*g\s*g/gi,"large egg").replace(/\s{2,}/g," ")}for(let d=0;d<e.length;d++){const c=e[d],a=c.toLowerCase();let m=!1;if(!(c.match(/^[‚Ä¢\-*‚Äì‚Äî]\s*$/)||c.length<2)&&(l.instructions.some(r=>a.includes(r))?(s="instructions",m=!0):l.ingredients.some(r=>a.includes(r))?(s="ingredients",m=!0):l.nutrition.some(r=>a.includes(r))&&(s="nutrition",o=!0,m=!0),!m))if(s==="header")if(!i&&c.length>3){const r=I.some(b=>b.test(c)),E=c.split(/\s+/).length;!r&&E>1&&(t.itemName=c.replace(/^(recipe|dish):\s*/i,"").trim(),i=!0)}else i&&(l.timing.some(r=>a.includes(r))||a.includes("by ")||a.includes("tested by")||a.includes("servings")||a.includes("mins")||c.length>10&&!c.includes(":"))&&(t.description+=(t.description?" ":"")+c);else if(s==="ingredients")if(p.test(c))t.ingredients.push(""),t.ingredients.push(`--- ${c.slice(0,-1)} ---`);else{let r=c.replace(/^[-‚Ä¢*‚Äì‚Äî‚Ä¢]\s*/,"").replace(/^\d+\.\s*/,"").replace(/^Step\s*\d+[:\s]*/i,"").trim();r=v(r),r&&r.length>1&&t.ingredients.push(r)}else if(s==="instructions"){let r=c.replace(/^[-‚Ä¢*‚Äì‚Äî‚Ä¢]\s*/,"").replace(/^[0-9]+[.)]?\s*/,"").replace(/^step\s*[0-9]+[:\s]*/i,"").trim();if(/^(stepa?|steps?)$/i.test(r)||r.length<3||/^nam choc\.?$/i.test(r))continue;t.instructions.length>0&&!/^([A-Z0-9]|\').*/.test(r)&&r.length>0?t.instructions[t.instructions.length-1]+=" "+r:t.instructions.push(r)}else(s==="nutrition"||o)&&(t.notes+=(t.notes?`
`:"")+c)}t.itemName=t.itemName||"Untitled Recipe",t.description=t.description.trim(),t.notes&&t.notes.includes("calorie")&&(t.notes=`Nutrition Facts:
`+t.notes);const C=["italian","asian","vietnamese","chinese","mexican","indian","thai","dinner","lunch","breakfast","appetizer","dessert","soup","salad","healthy","vegetarian","vegan","gluten-free","low-carb"],y=t.description.toLowerCase();return C.forEach(d=>{if(y.includes(d)){const c=d.charAt(0).toUpperCase()+d.slice(1);t.categories.includes(c)||t.categories.push(c)}}),console.log("Parsed recipe data:",t),t}function Re(n){document.getElementById("itemName").value=n.itemName||"",document.getElementById("categories").value=(n.categories||[]).join(", "),document.getElementById("description").value=n.description||"",document.getElementById("ingredients").value=(n.ingredients||[]).join(`
`),document.getElementById("instructions").value=(n.instructions||[]).join(`
`);const e=document.getElementById("notes");e&&n.notes&&(e.value=n.notes)}function u(n){const e=document.getElementById("error-message");e&&(e.textContent=n,e.classList.remove("hidden"),setTimeout(()=>e.classList.add("hidden"),U.MESSAGE_TIMEOUT_MS))}function S(n){const e=document.getElementById("success-message");e&&(e.textContent=n,e.classList.remove("hidden"),setTimeout(()=>e.classList.add("hidden"),U.MESSAGE_TIMEOUT_MS))}function k(n="Loading..."){const e=document.getElementById("loading-overlay");e&&e.classList.remove("hidden")}function M(){const n=document.getElementById("loading-overlay");n&&n.classList.add("hidden")}function Le(n){const e=document.getElementById("edit-recipe-modal");e&&(document.getElementById("editItemName").value=n.itemName||"",document.getElementById("editCategories").value=(n.categories||[]).join(", "),document.getElementById("editDescription").value=n.description||"",document.getElementById("editIngredients").value=(n.ingredients||[]).join(`
`),document.getElementById("editInstructions").value=(n.instructions||[]).join(`
`),document.getElementById("editNotes").value=n.notes||"",L=n.id,e.classList.remove("hidden"),setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"center"})},100),document.getElementById("editItemName").focus())}async function Se(){if(!L){u("No recipe selected for editing.");return}const n={itemName:document.getElementById("editItemName").value,categories:document.getElementById("editCategories").value.split(",").map(e=>e.trim()).filter(Boolean),description:document.getElementById("editDescription").value,ingredients:document.getElementById("editIngredients").value.split(`
`).map(e=>e.trim()).filter(Boolean),instructions:document.getElementById("editInstructions").value.split(`
`).map(e=>e.trim()).filter(Boolean),notes:document.getElementById("editNotes").value};if(!n.itemName||n.ingredients.length===0||n.instructions.length===0){u("Recipe Name, Ingredients, and Instructions are required.");return}try{k("Updating recipe..."),await ge(L,n),document.getElementById("edit-recipe-modal").classList.add("hidden"),L=null}catch(e){console.error("Error updating recipe:",e)}finally{M()}}async function xe(){try{console.log("Starting application initialization..."),console.log("Initializing Firebase authentication..."),await se(re,ce),console.log("Firebase authentication initialized successfully"),console.log("Initializing UI components..."),ye(),console.log("UI components initialized successfully"),console.log("Waiting for user authentication before initializing recipes..."),console.log("Application initialized successfully")}catch(n){console.error("Failed to initialize app:",n);const e=n.message||"Unknown error occurred";x(`Failed to initialize the application: ${e}. Please refresh the page.`)}}window.addEventListener("userAuthenticated",async n=>{try{console.log("User authenticated, initializing recipes..."),await ae(),console.log("Recipes initialized successfully")}catch(e){console.error("Failed to initialize recipes:",e),x(`Failed to load recipes: ${e.message}`)}});window.onerror=function(n,e,t,s,i){console.error("Global error:",{message:n,source:e,lineno:t,colno:s,error:i});const o=i?i.message:n;return x(`An unexpected error occurred: ${o}. Please refresh the page.`),!1};window.onunhandledrejection=function(n){console.error("Unhandled promise rejection:",n.reason);const e=n.reason?n.reason.message:"Unknown error";x(`An unexpected error occurred: ${e}. Please refresh the page.`)};function x(n){const e=document.getElementById("error-message");e?(e.textContent=n,e.classList.remove("hidden"),setTimeout(()=>e.classList.add("hidden"),5e3)):console.error("Error message element not found:",n)}document.addEventListener("DOMContentLoaded",xe);window.addEventListener("firebaseInitialized",()=>{const n=D(),e=document.getElementById("login-section"),t=document.getElementById("login-form"),s=document.getElementById("login-error"),i=document.querySelector(".container");j(n,o=>{o?e&&i&&(e.classList.add("hidden"),i.classList.remove("hidden")):e&&i&&(e.classList.remove("hidden"),i.classList.add("hidden"))}),t&&t.addEventListener("submit",async o=>{o.preventDefault();const l=document.getElementById("login-email").value,p=document.getElementById("login-password").value;s.classList.add("hidden");try{await V(n,l,p)}catch{s.textContent="Login failed. Please check your credentials.",s.classList.remove("hidden")}})});
