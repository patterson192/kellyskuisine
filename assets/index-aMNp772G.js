import{initializeApp as H}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";import{getAuth as _,setPersistence as K,browserLocalPersistence as V,onAuthStateChanged as O,signInWithCustomToken as W,signInWithEmailAndPassword as J}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";import{getFirestore as b,setLogLevel as Q,collection as j,serverTimestamp as $,addDoc as X,query as Y,onSnapshot as ee,doc as q,deleteDoc as te,setDoc as ne}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";import{getAnalytics as ie}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();let f,L,se,oe,h;async function re(t,e){try{if(console.log("Starting Firebase initialization..."),!t||typeof t!="object")throw new Error("Invalid Firebase configuration");const s=["apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId"].filter(i=>!t[i]);if(s.length>0)throw new Error(`Missing required Firebase configuration fields: ${s.join(", ")}`);f=H(t),console.log("Firebase app initialized"),L=_(f),console.log("Firebase auth initialized"),await K(L,V),console.log("Firebase auth persistence enabled"),se=b(f),console.log("Firestore initialized");try{oe=ie(f),console.log("Analytics initialized")}catch(i){console.warn("Analytics initialization failed:",i)}Q("debug"),O(L,ce),await ae(),console.log("Firebase initialization completed successfully")}catch(n){throw console.error("Error initializing Firebase:",n),new Error(`Firebase initialization failed: ${n.message}`)}}async function ce(t){try{if(t){h=t.uid,console.log("User is signed in with UID:",h),localStorage.setItem("lastUserId",h);const e=document.getElementById("user-id-display");e&&(e.textContent=`User ID: ${h}`),window.dispatchEvent(new CustomEvent("userAuthenticated",{detail:{userId:h}}))}else console.log("User is signed out"),h=null}catch(e){throw console.error("Error in auth state change:",e),new Error(`Authentication state change failed: ${e.message}`)}}async function ae(){try{typeof __initial_auth_token<"u"&&__initial_auth_token?(await W(L,__initial_auth_token),console.log("Signed in with custom token")):console.log("No automatic sign-in - user must log in through the form")}catch(t){throw console.error("Error during sign-in:",t),new Error(`Authentication failed: ${t.message}`)}}function w(){return h}const le={apiKey:"AIzaSyAX1F4gzD0-nsAbj7yhSaJZxcwvWNRVFus",authDomain:"kelly-s-kuisine.firebaseapp.com",projectId:"kelly-s-kuisine",storageBucket:"kelly-s-kuisine.firebasestorage.app",messagingSenderId:"974729459966",appId:"1:974729459966:web:42bad27bd106242bfc0daf",measurementId:"G-CGY3C6F1Q2"},de="1:974729459966:web:42bad27bd106242bfc0daf",D={RECIPES:"recipes"},z={SEARCH_DEBOUNCE_MS:300,MESSAGE_TIMEOUT_MS:5e3};let p=[],R=null;async function ue(){if(!w())throw new Error("User must be authenticated to initialize recipes");me(),ge()}function me(){const t=b(f),e=w();if(console.log("[Recipes] Setting up listener for user:",e),!e){console.error("[Recipes] No user ID available, cannot set up recipes listener"),u("User authentication required to load recipes");return}const n=j(t,"users",e,D.RECIPES),s=Y(n);console.log("[Recipes] Firestore collection path:",`users/${e}/${D.RECIPES}`),console.log("[Recipes] Full collection reference:",n),R&&(console.log("[Recipes] Unsubscribing from previous listener"),R()),console.log("[Recipes] Starting Firestore listener..."),R=ee(s,i=>{console.log("[Recipes] ‚úÖ Snapshot received successfully!"),console.log(`[Recipes] Empty: ${i.empty}, Size: ${i.size}`),console.log("[Recipes] Snapshot metadata:",i.metadata),p=[],i.forEach(o=>{const l={id:o.id,...o.data()};console.log("[Recipes] Processing recipe document:",{id:o.id,data:o.data(),fullRecipe:l}),p.push(l)}),console.log("[Recipes] Final processed recipes array:",p),console.log("[Recipes] Number of recipes loaded:",p.length),p.sort((o,l)=>(o.itemName||"").localeCompare(l.itemName||"")),console.log("[Recipes] Calling displayRecipes..."),Z(),console.log("[Recipes] displayRecipes completed")},i=>{console.error("[Recipes] ‚ùå Error in Firestore listener:",i),console.error("[Recipes] Error details:",{code:i.code,message:i.message,stack:i.stack}),i.code==="permission-denied"?u("Permission denied: Please check your Firestore security rules"):i.code==="unavailable"?u("Database unavailable: Please check your internet connection"):u(`Failed to load recipes: ${i.message}`)}),console.log("[Recipes] Listener setup completed, unsubscribe function:",R)}function ge(){window.addEventListener("searchFilterChanged",t=>{const{searchTerm:e,filterCategory:n}=t.detail;pe(e,n)})}function pe(t,e){const n=t?t.toLowerCase():"",s=p.filter(i=>{const o=!n||i.itemName&&i.itemName.toLowerCase().includes(n)||i.description&&i.description.toLowerCase().includes(n)||i.ingredients&&i.ingredients.some(g=>g.toLowerCase().includes(n))||i.instructions&&i.instructions.some(g=>g.toLowerCase().includes(n)),l=e==="All"||i.categories&&i.categories.includes(e);return o&&l});Z(s)}function Z(t=p){console.log("[Recipes] üéØ displayRecipes called"),console.log("[Recipes] Recipes to display:",t),console.log("[Recipes] Number of recipes to display:",t.length);const e=document.getElementById("recipe-container");if(!e){console.error("[Recipes] ‚ùå Recipe container element not found!"),console.error('[Recipes] Available elements with "recipe" in ID:',Array.from(document.querySelectorAll('[id*="recipe"]')).map(n=>n.id));return}if(console.log("[Recipes] ‚úÖ Recipe container found:",e),console.log("[Recipes] Container styles:",{display:window.getComputedStyle(e).display,height:window.getComputedStyle(e).height,width:window.getComputedStyle(e).width,visibility:window.getComputedStyle(e).visibility,position:window.getComputedStyle(e).position}),console.log("[Recipes] Container current content length:",e.innerHTML.length),t.length===0){const n='<p class="text-center text-gray-500 col-span-full">No recipes found. Try adjusting your search or add a new recipe.</p>';e.innerHTML=n,console.log('[Recipes] üìù Displayed "no recipes" message')}else e.innerHTML="",console.log("[Recipes] üßπ Cleared container, adding recipe cards..."),t.forEach((n,s)=>{console.log(`[Recipes] Creating card ${s+1}/${t.length} for recipe:`,n.itemName);try{const i=fe(n);e.appendChild(i),console.log(`[Recipes] ‚úÖ Card ${s+1} added successfully`)}catch(i){console.error(`[Recipes] ‚ùå Error creating card ${s+1}:`,i)}}),console.log("[Recipes] üéâ All recipe cards added to container");console.log("[Recipes] Final container content length:",e.innerHTML.length)}function fe(t){const e=document.createElement("div");e.className="bg-white rounded-xl shadow-lg overflow-hidden recipe-card flex flex-col justify-between min-h-[300px] w-full";const n=document.createElement("div");n.className="p-6";const s=t.itemName||"Unnamed Recipe",i=t.categories||[],o=t.description||"",l=t.ingredients||[],g=t.instructions||[],B=t.notes||"",I=document.createElement("h3");if(I.className="text-2xl font-playfair text-amber-700 mb-3",I.textContent=s,n.appendChild(I),i.length>0){const a=document.createElement("p");a.className="text-xs text-amber-500 mb-2",a.textContent=`Categories: ${i.join(", ")}`,n.appendChild(a)}if(o){const a=document.createElement("p");a.className="text-gray-600 text-sm mb-4",a.textContent=o,n.appendChild(a)}const C=(a,m,r)=>{if(m.length===0)return;const E=document.createElement("div");E.className="mt-4";const v=document.createElement("h4");v.className="font-semibold text-amber-600",v.textContent=a,E.appendChild(v);const N=document.createElement(r?"ol":"ul");N.className=`${r?"list-decimal":"list-disc"} list-inside text-gray-700 text-sm mt-2`,m.forEach(G=>{const U=document.createElement("li");U.textContent=G,N.appendChild(U)}),E.appendChild(N),n.appendChild(E)};if(C("Ingredients:",l,!1),C("Instructions:",g,!0),B){const a=document.createElement("div");a.className="mt-4";const m=document.createElement("h4");m.className="font-semibold text-amber-600",m.textContent="Notes:",a.appendChild(m);const r=document.createElement("p");r.className="text-gray-600 italic text-sm mt-2",r.textContent=B,a.appendChild(r),n.appendChild(a)}e.appendChild(n);const y=document.createElement("div");y.className="p-6 pt-0 flex justify-end space-x-2";const d=document.createElement("button");d.className="edit-recipe px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm",d.textContent="Edit",d.dataset.recipeId=t.id,d.addEventListener("click",()=>Ie(t.id));const c=document.createElement("button");return c.className="delete-recipe px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 text-sm",c.textContent="Delete",c.dataset.recipeId=t.id,c.addEventListener("click",()=>Ee(t.id)),y.appendChild(d),y.appendChild(c),e.appendChild(y),e}async function he(t){try{console.log("Starting to add recipe:",t);const e=b(f),n=w();if(console.log("Current user ID:",n),!n)throw new Error("User not authenticated for adding recipe.");const s=j(e,"users",n,"recipes");console.log("Firestore collection path:",`users/${n}/recipes`);const i={...t,createdAt:$(),updatedAt:$()};console.log("Attempting to save recipe to Firestore...");const o=await X(s,i);console.log("Recipe saved successfully with ID:",o.id),x("Recipe added successfully!")}catch(e){throw console.error("Error adding recipe to Firestore:",e),console.error("Error details:",{code:e.code,message:e.message,stack:e.stack}),u(`Failed to add recipe: ${e.message}`),e}}async function ye(t,e){try{const n=b(f),s=w();if(!s)throw new Error("User not authenticated for updating recipe.");const i=q(n,"users",s,"recipes",t),o={...e,updatedAt:$()};await ne(i,o,{merge:!0}),x("Recipe updated successfully!")}catch(n){throw console.error("Error updating recipe in Firestore:",n),u("Failed to update recipe."),n}}async function Ee(t){try{if(!confirm("Are you sure you want to delete this recipe?"))return;const e=b(f),n=w();if(!n)throw new Error("User not authenticated for deleting recipe.");const s=q(e,"users",n,"recipes",t);await te(s),x("Recipe deleted successfully!")}catch(e){throw console.error("Error deleting recipe from Firestore:",e),u("Failed to delete recipe."),e}}function Ie(t){const e=p.find(n=>n.id===t);e?Ne(e):u("Recipe not found for editing.")}let A="",F="All",S=null;function ve(){be(),we(),Be()}function be(){console.log("Attaching UI event listeners...");const t=document.getElementById("manualEntryBox"),e=document.getElementById("ocrEntryBox"),n=document.getElementById("addManualRecipeButton"),s=document.getElementById("cancelEditButton");t&&t.addEventListener("click",()=>{console.log("Manual entry box clicked!"),document.getElementById("manualInputSection").classList.remove("hidden"),document.getElementById("ocrInputSection").classList.add("hidden")}),e&&e.addEventListener("click",()=>{console.log("OCR entry box clicked!"),document.getElementById("ocrInputSection").classList.remove("hidden"),document.getElementById("manualInputSection").classList.add("hidden")}),n&&n.addEventListener("click",Re);const i=document.getElementById("addFileRecipeButton");i&&i.addEventListener("click",Le);const o=document.getElementById("saveChangesButton");o&&o.addEventListener("click",Ae),s&&s.addEventListener("click",()=>{document.getElementById("edit-recipe-modal").classList.add("hidden")})}function we(){const t=document.getElementById("searchInput"),e=document.getElementById("categoryFilter");if(t){let n;t.addEventListener("input",s=>{clearTimeout(n),n=setTimeout(()=>{A=s.target.value.toLowerCase(),window.dispatchEvent(new CustomEvent("searchFilterChanged",{detail:{searchTerm:A,filterCategory:F}}))},z.SEARCH_DEBOUNCE_MS)})}e&&e.addEventListener("change",n=>{F=n.target.value,window.dispatchEvent(new CustomEvent("searchFilterChanged",{detail:{searchTerm:A,filterCategory:F}}))})}function Be(){const t=document.getElementById("recipeForm");if(!t)return;t.querySelectorAll("input, textarea").forEach(n=>{n.addEventListener("input",()=>Ce(n))})}function Ce(t){const e=t.value;let n=!0,s="";t.required&&!e.trim()&&(n=!1,s="This field is required");const i=t.getAttribute("maxlength");i&&e.length>i&&(n=!1,s=`Maximum length is ${i} characters`),t.classList.toggle("border-red-500",!n);const o=t.parentElement.querySelector(".error-message");return o&&(o.textContent=s,o.classList.toggle("hidden",n)),n}async function Re(t){t.preventDefault();const e={itemName:document.getElementById("itemName").value,categories:document.getElementById("categories").value,description:document.getElementById("description").value,ingredients:document.getElementById("ingredients").value,instructions:document.getElementById("instructions").value,notes:document.getElementById("notes").value||""};if(e.categories=e.categories.split(",").map(n=>n.trim()).filter(Boolean),e.ingredients=e.ingredients.split(`
`).map(n=>n.trim()).filter(Boolean),e.instructions=e.instructions.split(`
`).map(n=>n.trim()).filter(Boolean),!e.itemName||e.ingredients.length===0||e.instructions.length===0){u("Recipe Name, Ingredients, and Instructions are required.");return}try{k("Saving recipe..."),await he(e),document.getElementById("itemName").value="",document.getElementById("categories").value="",document.getElementById("description").value="",document.getElementById("ingredients").value="",document.getElementById("instructions").value="",document.getElementById("notes").value="",document.getElementById("manualInputSection").classList.add("hidden")}catch(n){console.error("Error saving recipe:",n)}finally{M()}}async function Le(){const t=document.getElementById("fileInput"),e=t.files[0];if(!e){u("Please select a file to upload.");return}k("Processing file, this may take a moment...");try{let n="";if(e.type==="text/plain")n=await e.text();else if(e.type.startsWith("image/")){const{data:i}=await Tesseract.recognize(e,"eng",{logger:o=>console.log(`[OCR] ${o.status}: ${Math.round(o.progress*100)}%`)});n=i.text}else throw new Error("Unsupported file type. Please use .txt, .jpg, or .png.");const s=Se(n);xe(s),document.getElementById("manualInputSection").classList.remove("hidden"),document.getElementById("ocrInputSection").classList.add("hidden"),x("Recipe data extracted! Please review and save.")}catch(n){console.error("Error processing file:",n),u(n.message||"Failed to process file.")}finally{M(),t.value=""}}function Se(t){const e=t.split(`
`).map(d=>d.trim()).filter(Boolean);if(e.length===0)return{};const n={itemName:"",description:"",categories:[],ingredients:[],instructions:[],notes:""};let s="header",i=!1,o=!1;const l={ingredients:["ingredients"],instructions:["instructions","directions","method","preparation","steps"],nutrition:["nutrition facts","nutrition information","per serving","calories"],timing:["prep time","total time","cook time","servings","serves","yield"]},g=/^([A-Za-z\s]+):\s*$/,B=[/allrecipes/i,/alecipes/i,/food\.com/i,/epicurious/i,/tasty/i,/yummly/i,/test kitchen/i,/submitted by/i,/tested by/i,/recipe hub/i,/recipe of the day/i,/recipe(s)?!/i,/\bservings?\b/i,/\bminutes?\b/i,/\bcook time\b/i,/\bprep time\b/i,/\btotal time\b/i];function I(d){return d.replace(/¬Ω/g,"1/2").replace(/‚Öì/g,"1/3").replace(/‚Öî/g,"2/3").replace(/¬º/g,"1/4").replace(/¬æ/g,"3/4").replace(/‚Öï/g,"1/5").replace(/‚Öñ/g,"2/5").replace(/‚Öó/g,"3/5").replace(/‚Öò/g,"4/5").replace(/‚Öô/g,"1/6").replace(/‚Öö/g,"5/6").replace(/‚Öõ/g,"1/8").replace(/‚Öú/g,"3/8").replace(/‚Öù/g,"5/8").replace(/‚Öû/g,"7/8").replace(/(^|\s)%(?=\s|$)/g,"$11/2").replace(/%/g,"1/2").replace(/(\d)([a-zA-Z])/g,"$1 $2").replace(/\b[Ii]nafood\b/g,"In a food").replace(/\b[Ii]nthe\b/g,"in the").replace(/\b[Ii]ntoa\b/g,"into a").replace(/\b[Ii]ntothe\b/g,"into the").replace(/\b[Ii]n([aA])([A-Za-z]+)/g,"In a $2").replace(/\b([Oo]f|[Tt]o|[Oo]n|[Aa]t|[Bb]y|[Aa]n|[Aa])([A-Z][a-z]+)/g,"$1 $2").replace(/\b([a-zA-Z]{1,2})([A-Z][a-z]+)/g,"$1 $2").replace(/([a-z])([A-Z])/g,"$1 $2").replace(/([a-z])([ai])([a-z]+)/g,"$1 $2$3").replace(/t\s*a\s*s\s*p\s*o\s*o\s*n/gi,"teaspoon").replace(/t\s*b\s*s\s*p\s*o\s*o\s*n/gi,"tablespoon").replace(/b\s*a\s*k\s*i\s*n\s*g/gi,"baking").replace(/m\s*i\s*l\s*k/gi,"milk").replace(/a\s*a\s*l\s*l-?p\s*u\s*r\s*p\s*o\s*s\s*e/gi,"all-purpose").replace(/s\s*u\s*g\s*a\s*r/gi,"sugar").replace(/b\s*u\s*t\s*t\s*e\s*r/gi,"butter").replace(/e\s*g\s*g/gi,"egg").replace(/l\s*a\s*r\s*g\s*e/gi,"large").replace(/f\s*l\s*o\s*u\s*r/gi,"flour").replace(/p\s*o\s*w\s*d\s*e\s*r/gi,"powder").replace(/s\s*a\s*l\s*t/gi,"salt").replace(/m\s*e\s*l\s*t/gi,"melt").replace(/w\s*h\s*i\s*t\s*e/gi,"white").replace(/a\s*r\s*g\s*e\s*e\s*g\s*g/gi,"large egg").replace(/a\s*r\s*g\s*e\s*g\s*g/gi,"large egg").replace(/l\s*a\s*r\s*g\s*e\s*e\s*g\s*g/gi,"large egg").replace(/\s{2,}/g," ")}for(let d=0;d<e.length;d++){const c=e[d],a=c.toLowerCase();let m=!1;if(!(c.match(/^[‚Ä¢\-*‚Äì‚Äî]\s*$/)||c.length<2)&&(l.instructions.some(r=>a.includes(r))?(s="instructions",m=!0):l.ingredients.some(r=>a.includes(r))?(s="ingredients",m=!0):l.nutrition.some(r=>a.includes(r))&&(s="nutrition",o=!0,m=!0),!m))if(s==="header")if(!i&&c.length>3){const r=B.some(v=>v.test(c)),E=c.split(/\s+/).length;!r&&E>1&&(n.itemName=c.replace(/^(recipe|dish):\s*/i,"").trim(),i=!0)}else i&&(l.timing.some(r=>a.includes(r))||a.includes("by ")||a.includes("tested by")||a.includes("servings")||a.includes("mins")||c.length>10&&!c.includes(":"))&&(n.description+=(n.description?" ":"")+c);else if(s==="ingredients")if(g.test(c))n.ingredients.push(""),n.ingredients.push(`--- ${c.slice(0,-1)} ---`);else{let r=c.replace(/^[-‚Ä¢*‚Äì‚Äî‚Ä¢]\s*/,"").replace(/^\d+\.\s*/,"").replace(/^Step\s*\d+[:\s]*/i,"").trim();r=I(r),r&&r.length>1&&n.ingredients.push(r)}else if(s==="instructions"){let r=c.replace(/^[-‚Ä¢*‚Äì‚Äî‚Ä¢]\s*/,"").replace(/^[0-9]+[.)]?\s*/,"").replace(/^step\s*[0-9]+[:\s]*/i,"").trim();if(/^(stepa?|steps?)$/i.test(r)||r.length<3||/^nam choc\.?$/i.test(r))continue;n.instructions.length>0&&!/^([A-Z0-9]|\').*/.test(r)&&r.length>0?n.instructions[n.instructions.length-1]+=" "+r:n.instructions.push(r)}else(s==="nutrition"||o)&&(n.notes+=(n.notes?`
`:"")+c)}n.itemName=n.itemName||"Untitled Recipe",n.description=n.description.trim(),n.notes&&n.notes.includes("calorie")&&(n.notes=`Nutrition Facts:
`+n.notes);const C=["italian","asian","vietnamese","chinese","mexican","indian","thai","dinner","lunch","breakfast","appetizer","dessert","soup","salad","healthy","vegetarian","vegan","gluten-free","low-carb"],y=n.description.toLowerCase();return C.forEach(d=>{if(y.includes(d)){const c=d.charAt(0).toUpperCase()+d.slice(1);n.categories.includes(c)||n.categories.push(c)}}),console.log("Parsed recipe data:",n),n}function xe(t){document.getElementById("itemName").value=t.itemName||"",document.getElementById("categories").value=(t.categories||[]).join(", "),document.getElementById("description").value=t.description||"",document.getElementById("ingredients").value=(t.ingredients||[]).join(`
`),document.getElementById("instructions").value=(t.instructions||[]).join(`
`);const e=document.getElementById("notes");e&&t.notes&&(e.value=t.notes)}function u(t){const e=document.getElementById("error-message");e&&(e.textContent=t,e.classList.remove("hidden"),setTimeout(()=>e.classList.add("hidden"),z.MESSAGE_TIMEOUT_MS))}function x(t){const e=document.getElementById("success-message");e&&(e.textContent=t,e.classList.remove("hidden"),setTimeout(()=>e.classList.add("hidden"),z.MESSAGE_TIMEOUT_MS))}function k(t="Loading..."){const e=document.getElementById("loading-overlay");e&&e.classList.remove("hidden")}function M(){const t=document.getElementById("loading-overlay");t&&t.classList.add("hidden")}function Ne(t){const e=document.getElementById("edit-recipe-modal");e&&(document.getElementById("editItemName").value=t.itemName||"",document.getElementById("editCategories").value=(t.categories||[]).join(", "),document.getElementById("editDescription").value=t.description||"",document.getElementById("editIngredients").value=(t.ingredients||[]).join(`
`),document.getElementById("editInstructions").value=(t.instructions||[]).join(`
`),document.getElementById("editNotes").value=t.notes||"",S=t.id,e.classList.remove("hidden"),setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"center"})},100),document.getElementById("editItemName").focus())}async function Ae(){if(!S){u("No recipe selected for editing.");return}const t={itemName:document.getElementById("editItemName").value,categories:document.getElementById("editCategories").value.split(",").map(e=>e.trim()).filter(Boolean),description:document.getElementById("editDescription").value,ingredients:document.getElementById("editIngredients").value.split(`
`).map(e=>e.trim()).filter(Boolean),instructions:document.getElementById("editInstructions").value.split(`
`).map(e=>e.trim()).filter(Boolean),notes:document.getElementById("editNotes").value};if(!t.itemName||t.ingredients.length===0||t.instructions.length===0){u("Recipe Name, Ingredients, and Instructions are required.");return}try{k("Updating recipe..."),await ye(S,t),document.getElementById("edit-recipe-modal").classList.add("hidden"),S=null}catch(e){console.error("Error updating recipe:",e)}finally{M()}}async function Fe(){try{console.log("Starting application initialization..."),console.log("Initializing Firebase authentication..."),await re(le,de),console.log("Firebase authentication initialized successfully"),console.log("Initializing UI components..."),ve(),console.log("UI components initialized successfully"),console.log("Initializing recipes..."),await ue(),console.log("Recipes initialized successfully"),console.log("Application initialized successfully")}catch(t){console.error("Failed to initialize app:",t);const e=t.message||"Unknown error occurred";T(`Failed to initialize the application: ${e}. Please refresh the page.`)}}window.onerror=function(t,e,n,s,i){console.error("Global error:",{message:t,source:e,lineno:n,colno:s,error:i});const o=i?i.message:t;return T(`An unexpected error occurred: ${o}. Please refresh the page.`),!1};window.onunhandledrejection=function(t){console.error("Unhandled promise rejection:",t.reason);const e=t.reason?t.reason.message:"Unknown error";T(`An unexpected error occurred: ${e}. Please refresh the page.`)};function T(t){const e=document.getElementById("error-message");e?(e.textContent=t,e.classList.remove("hidden"),setTimeout(()=>e.classList.add("hidden"),5e3)):console.error("Error message element not found:",t)}document.addEventListener("DOMContentLoaded",Fe);const P=_();window.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("login-section"),e=document.getElementById("login-form"),n=document.getElementById("login-error"),s=document.querySelector(".container");O(P,i=>{i?t&&s&&(t.classList.add("hidden"),s.classList.remove("hidden")):t&&s&&(t.classList.remove("hidden"),s.classList.add("hidden"))}),e&&e.addEventListener("submit",async i=>{i.preventDefault();const o=document.getElementById("login-email").value,l=document.getElementById("login-password").value;n.classList.add("hidden");try{await J(P,o,l)}catch{n.textContent="Login failed. Please check your credentials.",n.classList.remove("hidden")}})});
