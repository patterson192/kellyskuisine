import{initializeApp as C}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";import{getAuth as A,onAuthStateChanged as z,signInWithCustomToken as M,signInAnonymously as $}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";import{getFirestore as b,setLogLevel as N,collection as R,query as T,onSnapshot as B}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";import{getAnalytics as _}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();let u,m,U,D,l;async function O(e,t){try{if(console.log("Starting Firebase initialization..."),!e||typeof e!="object")throw new Error("Invalid Firebase configuration");const s=["apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId"].filter(n=>!e[n]);if(s.length>0)throw new Error(`Missing required Firebase configuration fields: ${s.join(", ")}`);u=C(e),console.log("Firebase app initialized"),m=A(u),console.log("Firebase auth initialized"),U=b(u),console.log("Firestore initialized");try{D=_(u),console.log("Analytics initialized")}catch(n){console.warn("Analytics initialization failed:",n)}N("debug"),z(m,k),await v(),console.log("Firebase initialization completed successfully")}catch(i){throw console.error("Error initializing Firebase:",i),new Error(`Firebase initialization failed: ${i.message}`)}}async function k(e){try{if(e){l=e.uid,console.log("User is signed in with UID:",l);const t=document.getElementById("user-id-display");t&&(t.textContent=`User ID: ${l}`),window.dispatchEvent(new CustomEvent("userAuthenticated",{detail:{userId:l}}))}else console.log("User is signed out"),l=null,await v()}catch(t){throw console.error("Error in auth state change:",t),new Error(`Authentication state change failed: ${t.message}`)}}async function v(){try{typeof __initial_auth_token<"u"&&__initial_auth_token?(await M(m,__initial_auth_token),console.log("Signed in with custom token")):(await $(m),console.log("Signed in anonymously"))}catch(e){throw console.error("Error during sign-in:",e),new Error(`Authentication failed: ${e.message}`)}}function S(){return l}const q={apiKey:"AIzaSyAX1F4gzD0-nsAbj7yhSaJZxcwvWNRVFus",authDomain:"kelly-s-kuisine.firebaseapp.com",projectId:"kelly-s-kuisine",storageBucket:"kelly-s-kuisine.firebasestorage.app",messagingSenderId:"974729459966",appId:"1:974729459966:web:42bad27bd106242bfc0daf",measurementId:"G-CGY3C6F1Q2"},j="1:974729459966:web:42bad27bd106242bfc0daf",E={SEARCH_DEBOUNCE_MS:300,MESSAGE_TIMEOUT_MS:5e3};let a=[],p=null;async function P(){if(!S())throw new Error("User must be authenticated to initialize recipes");G(),H()}function G(){const e=b(),t=S(),i=R(e,`users/${t}/${COLLECTIONS.RECIPES}`),s=T(i);p&&p(),p=B(s,n=>{a=[],n.forEach(o=>{a.push({id:o.id,...o.data()})}),a.sort((o,r)=>o.itemName.localeCompare(r.itemName)),w()},n=>{console.error("Error loading recipes:",n),d("Failed to load recipes. Please check your connection.")})}function H(){window.addEventListener("searchFilterChanged",e=>{const{searchTerm:t,filterCategory:i}=e.detail;V(t,i)})}function V(e,t){const i=e?e.toLowerCase():"",s=a.filter(n=>{const o=!i||n.itemName&&n.itemName.toLowerCase().includes(i)||n.description&&n.description.toLowerCase().includes(i)||n.ingredients&&n.ingredients.some(c=>c.toLowerCase().includes(i))||n.instructions&&n.instructions.some(c=>c.toLowerCase().includes(i)),r=t==="All"||n.categories&&n.categories.includes(t);return o&&r});w(s)}function w(e=a){const t=document.getElementById("recipe-container");t&&(t.innerHTML=e.length===0?'<p class="text-center text-gray-500 col-span-full">No recipes found. Try adjusting your search or add a new recipe.</p>':"",e.forEach(i=>{const s=K(i);t.appendChild(s)}))}function K(e){const t=document.createElement("div");t.className="bg-white rounded-xl shadow-lg overflow-hidden recipe-card";const i=e.itemName||"Unnamed Recipe",s=e.categories||[],n=e.description||"No description provided.",o=e.ingredients||[],r=e.instructions||[],c=e.notes||"";return t.innerHTML=`
        <div class="p-6">
            <h3 class="text-2xl font-playfair text-amber-700 mb-3">${i}</h3>
            ${s.length>0?`<p class="text-xs text-amber-500 mb-2">Categories: ${s.join(", ")}</p>`:""}
            <p class="text-gray-600 text-sm mb-4">${n}</p>
            
            ${o.length>0?`
            <div class="mt-4">
                <h4 class="font-semibold text-amber-600">Ingredients:</h4>
                <ul class="list-disc list-inside text-gray-700 text-sm mt-2">
                    ${o.map(g=>`<li>${g}</li>`).join("")}
                </ul>
            </div>`:""}

            ${r.length>0?`
            <div class="mt-4">
                <h4 class="font-semibold text-amber-600">Instructions:</h4>
                <ol class="list-decimal list-inside text-gray-700 text-sm mt-2">
                    ${r.map(g=>`<li>${g}</li>`).join("")}
                </ol>
            </div>`:""}

            ${c?`
                <div class="mt-4">
                    <h4 class="font-semibold text-amber-600">Notes:</h4>
                    <p class="text-gray-600 italic text-sm mt-2">${c}</p>
                </div>
            `:""}

            <div class="mt-6 flex justify-end space-x-2">
                <button class="edit-recipe px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm"
                        data-recipe-id="${e.id}">Edit</button>
                <button class="delete-recipe px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 text-sm"
                        data-recipe-id="${e.id}">Delete</button>
            </div>
        </div>
    `,t.querySelector(".edit-recipe").addEventListener("click",()=>J(e.id)),t.querySelector(".delete-recipe").addEventListener("click",()=>handleDeleteRecipe(e.id)),t}async function W(e){try{const t={...e,id:Date.now().toString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};a.push(t),a.sort((i,s)=>(i.itemName||"").localeCompare(s.itemName||"")),saveRecipesToLocalStorage(),w(),F("Recipe added successfully!")}catch(t){console.error("Error adding recipe:",t),d("Failed to add recipe.")}}function J(e){const t=a.find(i=>i.id===e);d(t?"Edit modal functionality is not implemented.":"Recipe not found for editing.")}let f="",h="All";function Q(){X(),Y(),Z()}function X(){const e=document.getElementById("toggleManualInputButton"),t=document.getElementById("cancelButton"),i=document.getElementById("recipeForm");e&&e.addEventListener("click",()=>{console.log("Add New Recipe button clicked"),y()}),t&&t.addEventListener("click",()=>{y(),x()}),i&&i.addEventListener("submit",ee)}function Y(){const e=document.getElementById("searchInput"),t=document.getElementById("categoryFilter");if(e){let i;e.addEventListener("input",s=>{clearTimeout(i),i=setTimeout(()=>{f=s.target.value.toLowerCase(),window.dispatchEvent(new CustomEvent("searchFilterChanged",{detail:{searchTerm:f,filterCategory:h}}))},E.SEARCH_DEBOUNCE_MS)})}t&&t.addEventListener("change",i=>{h=i.target.value,window.dispatchEvent(new CustomEvent("searchFilterChanged",{detail:{searchTerm:f,filterCategory:h}}))})}function Z(){const e=document.getElementById("recipeForm");if(!e)return;e.querySelectorAll("input, textarea").forEach(i=>{i.addEventListener("input",()=>L(i))})}function L(e){const t=e.value;let i=!0,s="";e.required&&!t.trim()&&(i=!1,s="This field is required");const n=e.getAttribute("maxlength");n&&t.length>n&&(i=!1,s=`Maximum length is ${n} characters`),e.classList.toggle("border-red-500",!i);const o=e.parentElement.querySelector(".error-message");return o&&(o.textContent=s,o.classList.toggle("hidden",i)),i}async function ee(e){e.preventDefault();const t=e.target,i=new FormData(t),s=Object.fromEntries(i.entries());let n=!0;if(t.querySelectorAll("input[required], textarea[required]").forEach(r=>{L(r)||(n=!1)}),!n){d("Please fill in all required fields correctly.");return}try{te("Saving recipe..."),await W(s),F("Recipe added successfully!"),x(),y()}catch(r){console.error("Error saving recipe:",r),d("Failed to save recipe. Please try again.")}finally{ne()}}function y(){console.log("toggleManualInput function called");const e=document.getElementById("manualInputSection");e&&(console.log("manualInputSection found, current classes:",e.className),e.classList.toggle("hidden"),console.log("manualInputSection classes after toggle:",e.className))}function x(){const e=document.getElementById("recipeForm");e&&e.reset()}function d(e){const t=document.getElementById("error-message");t&&(t.textContent=e,t.classList.remove("hidden"),setTimeout(()=>t.classList.add("hidden"),E.MESSAGE_TIMEOUT_MS))}function F(e){const t=document.getElementById("success-message");t&&(t.textContent=e,t.classList.remove("hidden"),setTimeout(()=>t.classList.add("hidden"),E.MESSAGE_TIMEOUT_MS))}function te(e="Loading..."){const t=document.getElementById("loading-overlay");t&&t.classList.remove("hidden")}function ne(){const e=document.getElementById("loading-overlay");e&&e.classList.add("hidden")}async function ie(){try{console.log("Starting application initialization..."),console.log("Initializing Firebase authentication..."),await O(q,j),console.log("Firebase authentication initialized successfully"),console.log("Initializing UI components..."),Q(),console.log("UI components initialized successfully"),console.log("Initializing recipes..."),await P(),console.log("Recipes initialized successfully"),console.log("Application initialized successfully")}catch(e){console.error("Failed to initialize app:",e);const t=e.message||"Unknown error occurred";I(`Failed to initialize the application: ${t}. Please refresh the page.`)}}window.onerror=function(e,t,i,s,n){console.error("Global error:",{message:e,source:t,lineno:i,colno:s,error:n});const o=n?n.message:e;return I(`An unexpected error occurred: ${o}. Please refresh the page.`),!1};window.onunhandledrejection=function(e){console.error("Unhandled promise rejection:",e.reason);const t=e.reason?e.reason.message:"Unknown error";I(`An unexpected error occurred: ${t}. Please refresh the page.`)};function I(e){const t=document.getElementById("error-message");t?(t.textContent=e,t.classList.remove("hidden"),setTimeout(()=>t.classList.add("hidden"),5e3)):console.error("Error message element not found:",e)}document.addEventListener("DOMContentLoaded",ie);
